<div class="profile-banner">
  <%= video_tag('animatedprofile.mp4', id: 'profile-background', autoplay: true, loop: true, muted: true) %>
</div>

<div class="container">
  <div class="profile-card">

    <div class="user-info">
      <div class="user-image-container">
      </div>
      <div class="user-name-container">
        <p class="user-fname"><%= @user.first_name %></p>
        <p class="user-lname"><%= @user.last_name %></p>
      </div>
      <% if current_user.is_admin %>
        <p class="user-type">Garden administrator</p>
      <% else %>
        <p class="user-type">Plant enthusiast</p>
      <% end %>
    </div>

    <div class="user-info-bottom">
      <div class="accordion" id="accordionExample">


        <div class="accordion-item">
          <h2 class="accordion-header" id="headingOne">
            <% if current_user.is_admin %>
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                My garden events
              </button>
            <% else %>
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                My events
              </button>
            <% end %>
          </h2>
          <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <% if @events.any? %>
                <%= render "shared/event" %>
              <% else %>
                <p class="no-events">You have no events scheduled...</p>
              <% end %>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <h2 class="accordion-header" id="headingTwo">
            <% if current_user.is_admin %>
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                Events I am attending
              </button>
            <% else %>
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                Favourite Gardens
              </button>
            <% end %>
          </h2>
          <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <% if @attending_events.any? %>
                <%= render "shared/event" %>
              <% else %>
                <p class="no-events">You have no events scheduled...</p>
              <% end %>
            </div>
          </div>
        </div>


        <div class="accordion-item">
          <h2 class="accordion-header" id="headingThree">
            <% if current_user.is_admin %>
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                Favourite Gardens
              </button>
            <% end %>
          </h2>
          <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <% if current_user.is_admin %>
                <% if @favourited_gardens.any? %>
                  <div class="event-list">
                      <% @favourited_gardens.each do |bookmark| %>
                        <%= render "gardens/garden_card", garden: bookmark.garden%>
                      <% end %>
                  </div>
                <% else %>
                  <p class="no-events">You have no favourite gardens...</p>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
        <div class="accordion-item">
          <h2 class="accordion-header" id="headingFour">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
              <% if current_user.is_admin  %>
                My Parcels
              <% else %>
                My reserved parcels
              <% end %>
            </button>
          </h2>
          <div id="collapseFour" class="accordion-collapse collapse" aria-labelledby="headingFour" data-bs-parent="#accordionExample">
            <div class="accordion-body">
              <% if current_user.is_admin %>
                <% if @parcels.any? %>
                  <ul class="list-group">
                    <% @parcels.each do |parcel| %>
                      <li class="list-group-item"><%= parcel.name %></li>
                    <% end %>
                  </ul>
                <% else %>
                  <p>You have no parcels...</p>
                <% end %>
              <% else %>
                <%= render "parcel_reservations/list", parcel_reservations: @parcel_reservations %>
              <% end %>
            </div>
          </div>
        </div>

      </div>
    </div>
    <% if @gardens.present? && current_user.is_admin %>
  <%= link_to "Add a new garden", new_garden_path, class: "action-button" %>
  <%= link_to "Add a new event", new_garden_event_path(garden_id: @gardens.first.id), class: "action-button" %>
  <%= link_to "Create a Parcel", new_garden_parcel_path(garden_id: @gardens.first.id), class: "action-button" %>
  <% elsif current_user.is_admin %>
  <%= link_to "Add a new garden", new_garden_path, class: "action-button" %>
  <p>No gardens available to add events.</p>
<% end %>
  <%= button_to "Log out", destroy_user_session_path, method: :delete, data: { turbo_method: :delete }, class: 'action-button', form_class: "profile-logout"%>
  </div>
</div>
